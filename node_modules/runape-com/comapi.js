"undefined"==typeof spinner&&(spinner=function(){}),"function"==typeof setSessionTimeout&&setSessionTimeout(!0),ComApi=function(){function e(e){var t,n,o=e.toLowerCase();return o.indexOf("hunter/")>-1?(t=1175,n=93):o.indexOf("webscape/")>-1||o.indexOf("apiaccess/")>-1?(t=1182,n=234):o.indexOf("quotas/")>-1?(t=1177,n=268):o.indexOf("issues/")>-1?(t=1176,n=262):o.indexOf("feedback/")>-1?(t=1194,n=290):o.indexOf("api/")>-1||console.warn("Resource not defined: "+o),{ModuleId:t,TabId:n}}function t(e){var t=void 0!==e.onStorageSet&&void 0!==e.onStorageGet&&!!e.onStorageGet().Token;return t}function n(e){var t;if(""===e)t="";else try{t=JSON.parse(e)}catch(n){t=e}return t}function o(e,n,o,s,r){var i,a,u,c;if(t(n)){if(e.setRequestHeader("Authorization","Bearer "+n.onStorageGet().Token),!o)throw"URL must be set";i=n.getResourceIds(o),e.setRequestHeader("ModuleId",i.ModuleId),e.setRequestHeader("TabId",i.TabId),r()}else"object"==typeof sf&&(a=sf.getAntiForgeryValue(),u=o.indexOf("Quotas/GetCreditsLogs/")>-1,a.length>90||u||o.indexOf("Verification")>-1?(u||o.indexOf("Feedback")>-1||o.indexOf("Hunter")>-1?(i=n.getResourceIds(o),e.setRequestHeader("ModuleId",i.ModuleId),e.setRequestHeader("TabId",i.TabId),e.setRequestHeader("RequestVerificationToken",a)):sf.setModuleHeaders(e),r()):(e.abort(),c={},c.readyState=4,c.response='{"Message":"Authorization has been denied for this request."}',c.responseText='{"Message":"Authorization has been denied for this request."}',c.responseType="",c.status=401,c.statusText="Unauthorized",s(c)))}function s(e,t,n){"function"==typeof setSessionTimeout&&setSessionTimeout(!0),t?t(e,e.status,n.onErrorDefault):n.onErrorDefault(e)}function r(e,r,i,a,u,c){var d,f;h||(u.requestIntercept&&u.requestIntercept(e,c),a||spinner(e,!0),d=c?"POST":"GET",f=new XMLHttpRequest,f.withCredentials=!t(u),f.open(d,"https://runape.com/API/"+e),f.setRequestHeader("Content-Type","application/json; charset=utf-8"),o(f,u,e,function(t){a||spinner(e,!1),s(t,i,u)},function(){"GET"===d?f.send():f.send(JSON.stringify(c))}),f.onerror=function(){a||spinner(e,!1),s(f,i,u)},f.onabort=function(){a||spinner(e,!1),s(f,i,u)},f.ontimeout=function(){a||spinner(e,!1),s(f,i,u)},f.onload=function(){if(a||spinner(e,!1),200===f.status){if("function"==typeof setSessionTimeout&&setSessionTimeout(!0),r){var t=n(f.responseText);r(t)}}else s(f,i,u)})}function i(e,t,n,o){r(e,t,n,o,this)}function a(e,t,n,o,s){if(null==e||"object"!=typeof e)throw"The request must be an empty or a populated object";r(t,n,o,s,this,e)}function u(e){var t=e.msInHour+1,n=e.onStorageGet().CreatedOn;return n&&(t=new Date-new Date(n)),t>e.msInHour-e.tenSecInMs}function c(e){clearInterval(e.tokenWatchInterval),e.tokenWatchInterval=setInterval(function(){u(e)&&(e.onRenewExpired(),clearInterval(e.tokenWatchInterval))},5e3)}function d(e,t,s,r,i){function a(t){s?s(t,t.status,e.onErrorDefault):e.onErrorDefault(t)}var u="login"===r?"POST":"GET",c=new XMLHttpRequest;c.open(u,"https://runape.com/DesktopModules/JwtAuth/API/mobile/"+r),c.setRequestHeader("Content-Type","application/json; charset=utf-8"),"GET"===u&&o(c,e),c.onerror=c.onabort=c.ontimeout=function(){a(c,s,e)},c.onload=function(){if(200===c.status){var o=n(c.responseText);t(o)}else a(c,s,e)},"POST"===u?c.send(JSON.stringify(i)):c.send()}function f(e,n,o,r,i,a,u){function f(){d(p,function(e){var t={Token:e.accessToken,CreatedOn:Date(),RenewalToken:e.renewalToken};p.onStorageSet(t),c(p),n("New: "+JSON.stringify(t))},function(e){s(e,o,p)},"login",e)}var p,l,T,S,g;this.onRenewExpired=r,this.msInHour=36e5,this.tenSecInMs=1e4,h||(p=this,t(this)||(this.onStorageSet=a,this.onStorageGet=i),l=p.msInHour+1,T=this.onStorageGet().CreatedOn,T&&(l=new Date-new Date(T)),S=p.msInHour-p.tenSecInMs,l>S||u?(g=l-S,g<p.tenSecInMs?p.releaseToken(function(e){f()},function(e){f()}):t(p)?(p.onStorageSet({}),p.onRenewExpired()):f()):(c(p),n("Existing: "+JSON.stringify(p.onStorageGet()))))}function p(e,t){if(!h){var n=this;d(n,function(t){n.onStorageSet=n.onStorageGet=void 0,e(t)},function(e){n.onStorageSet=n.onStorageGet=void 0,s(e,t,n)},"logout")}}function l(e,t){function n(e){var n,o,u,c,d;if(!a&&(a=!0,document&&document.getElementById("reconnectTimer")&&(n=$("#reconnectTimer"),n.length>0))){if(o=n.text(),"none"!==n.css("display")&&o.indexOf("Connecting...")===-1)return;u=r[parseInt(i.shift())],u?(n.text("Connecting...").show(),t({SocketError:e}),c=setInterval(function(){u-=1e3,n.text("Auto-retry in "+u/1e3+" sec.").show();var e=$("#statusInfo").text().trim();(u<0||"Connected"===e)&&(clearInterval(c),n.hide(),setTimeout(function(){a=!1},1e3),n.empty().hide(),s())},1e3)):(a=!1,d={SocketError:e},t(d))}}function o(n,o){browserTabId=n.Id.substring(0,6),"Denied"===n.Type&&t("Authentication token has expired or is invalid");var s=n.UpdatePort;T=new WebSocket("wss://runape.com:"+s+"/WebscapeNotifier"),T.onopen=function(){T.send(JSON.stringify(n))},T.onerror=function(e){o(e)},T.onclose=function(e){o(e)},T.onmessage=function(o){if(""===o.data)t("Empty update message received");else if("exit"===o.data)t("Server has stopped");else switch(n.Type){case UpdateType.Denied:t("Authentication token has expired or is invalid");break;case UpdateType.AllFieldsMustBePresent:case UpdateType.CouldNotExecuteAction:case UpdateType.RequestCouldNotBeProcessed:t(n.Type);break;default:var s=JSON.parse(o.data);(s.Type||null==s.Data&&null==s.Type&&null==s.IDs)&&(e(s),i=Object.keys(r))}}}function s(){ComApi.sendGet("Webscape/GetUpdateToken",function(e){o(e,n)})}var r,i,a;T&&"function"==typeof T.close&&(T.onclose=void 0,T.close(),T=void 0),r={1:500,2:3e3,3:1e4,4:6e4,5:9e4},i=Object.keys(r),a=!1,window.isError=!1,s()}var T,S,g=function(){},h=!1;return{getToken:f,isTokenSet:t,releaseToken:p,sendGet:i,sendPost:a,getUpdates:l,getResourceIds:e,onErrorDefault:g,requestIntercept:S}}(),"undefined"!=typeof exports&&(exports.getToken=function(e,t,n,o,s,r,i){ComApi.getToken(e,t,n,o,s,r,i)},exports.isTokenSet=function(){return ComApi.isTokenSet(this)},exports.releaseToken=function(e,t){ComApi.releaseToken(e,t)},exports.sendPost=function(e,t,n,o,s){ComApi.sendPost(e,t,n,o,s)},exports.sendGet=function(e,t,n,o){ComApi.sendGet(e,t,n,o)},exports.getUpdates=function(e,t){ComApi.getUpdates(e,t)},exports.getResourceIds=function(e){ComApi.getResourceIds(e)},exports.onErrorDefault=function(){ComApi.onErrorDefault()});